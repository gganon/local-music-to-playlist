# A script to create a Spotify Playlist from local directories of music files

I like to own digital copies of all my music but I also like the convenience of having a Spotify playlist to share my music with friends.

This set of scripts can be used to create and manage a Spotify playlist consisting of songs from local mp3/m4a/aac/etc files

## Prerequisites

* Node.js v20
* An already created Spotify playlist. Can be public or private. Can be empty (if it has tracks already, they will be replaced)
* A Spotify Developer Application
    * the client ID and client secret of this app will be needed for executing Spotify APIs to search for songs and update your playlist
    * Add `http://localhost:8080/redirect` as a redirect URL. This is used for OAuth authentication. You can configure a custom host and port if you want (instructions below)

## Install dependencies

```sh
npm install
```

## Variables

These scripts require some variables when you run them. Variables can be provided either as inline arguments like `--path`, `--spotify-client-id` or as ENV variables like `PATH=`, `SPOTIFY_CLIENT_ID=` or, if neither are provided and a variable is mandatory, the script will prompt you for a value when you run them. It's up to you which method you want to use for each variable. A list of variables is listed for each script below

## Step 1. Create a CSV from your library

Before creating a spotify playlist, we need to run a script that will scan your music directories and build a .csv file with
* Song metadata: album name, artist name, track title
* Closest match Spotify song URL

There are a few reasons why creating a CSV file of your library is useful:
1. If you run these scripts again in the future (like after adding/removing songs from your music folders), you can provide the CSV file generated from the last run and the script will use that to skip songs it has already processed. This can save a lot of time and also lets you customize the mapped Spotify tracks and persist your customizations
2. It gives you a chance to review the spotify songs that were matched up with your music. Sometimes the top result returned by the spotify search API isn't the best match for your song (or it can't find event 1 result). When that happens you can just come back to this CSV, by viewing in an app like Excel or Google Sheets, and modify some of the Spotify URLs mapped to your songs... or add URLs for songs where the script was unable to find an appropriate Spotify track

Running the script

```sh
node src/library-to-csv.js --path /path/to/music/folder --path /additional/music/folder --csv-out /path/to/generated.csv
```

Here is a list of variables used by the script

|CLI argument|environment variable|description|
|------------|--------------------|-----------|
|`--path`    |`PATH`              |One or more paths to folders with music files. Supported music files are whatever is supported by the [music-meta](https://www.npmjs.com/package/music-metadata) package. If you want to pass multiple paths, separate them by commas: `--path /dir1,/dir2`|
|`--csv-out` |`LIBRARY_CSV`       |Path to the output CSV file. If a .csv file at this path doesn't exist, it will be created with data from your music and mapped spotify track URLs. You can also provide a path to a .csv file generated by a previous run in which case, existing song entries will be skipped and song entries that are not found in `--path` will be deleted. It's advisable to back up your previous library .csv file before giving it to this commmand|
|`--spotify-client-id`|`SPOTIFY_CLIENT_ID`|Your Spotify Developer application's Client ID. If you don't want to provide this value in-line, you can skip this variable. The script will prompt you for it when you run it|
|`--spotify-client-secret`|`SPOTIFY_CLIENT_SECRET`|Your Spotify Developer application's Client Secret. If you don't want to provide this value in-line, you can skip this variable. The script will prompt you for it when you run it|

## Step 2. Add songs from CSV to your Spotify playlist

Before running this script you could (and probably should) review the CSV generated by the previous step. If the script was unable to find appropriate Spotify track URLs from some of your songs, you can add those in manually (or leave it blank). Rows without a Spotify URL will be skipped and not added to the playlist.

```sh
node src/csv-to-spotify.js --playlist-id u8VCBhfUwmR98 --csv /path/to/generated.csv
```

Here is a list of variables used by the script

|CLI argument|environment variable|description|
|---------------|---------------------|-----------|
|`--playlist-id`|`SPOTIFY_PLAYLIST_ID`|The ID of the Spotify playlist you want to add these songs to. **NOTE: Existing songs in this playlist will be replaced!!!**. You can get the ID of your playlist by opening it up in a browser and copying it from the URL in the address bar. It's usually in the format `https://open.spotify.com/playlist/<playlist_id>`|
|`--csv`        |`LIBRARY_CSV`        |Path to generated CSV file from the previous step|
|`--spotify-client-id`|`SPOTIFY_CLIENT_ID`|Your Spotify Developer application's Client ID. If you don't want to provide this value in-line, you can skip this variable. The script will prompt you for it when you run it|
|`--spotify-client-secret`|`SPOTIFY_CLIENT_SECRET`|Your Spotify Developer application's Client Secret. If you don't want to provide this value in-line, you can skip this variable. The script will prompt you for it when you run it|
|`--spotify-redirect-host`|`SPOTIFY_REDIRECT_HOST`|(Optional) If you want the Spotify authentication redirect URL's host to be something other than `localhost`, you can set this variable.|
|`--spotify-redirect-port`|`SPOTIFY_REDIRECT_HOST`|(Optional) If you want the Spotify authentication redirect URL's port to be something other than `8080`, you can set this variable.|
